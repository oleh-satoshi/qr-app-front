<!DOCTYPE html>
<html lang="ru">
<head>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–æ–∑–¥–∞—Ç—å QR-–∫–æ–¥</title>
    <style>
                @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap');

        body {
            font-family: 'Poppins', sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f4f4f4;
        }
        h1 {
            font-size: 24px;
            color: #333;
            text-align: center;
        }
        .form-container {
            background-color: #fff;
            border-radius: 15px;
            box-shadow: 0px 6px 12px rgba(0, 0, 0, 0.15);
            max-width: 400px;
            margin: 20px auto;
            padding: 20px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            font-size: 16px;
            margin-bottom: 8px;
        }
        .form-group input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
        }
        .create-button {
            background-color: #333;
            color: #fff;
            border: none;
            border-radius: 8px;
            padding: 12px 20px;
            font-size: 18px;
            font-weight: bold;
            width: 100%;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .create-button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }

        .create-button.success {
            background-color: #4CAF50 !important;
            color: #fff !important;
        }

        .after-buttons {
            margin-top: 20px;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
        }
        .after-buttons.show {
            opacity: 1;
        }
        .after-buttons button {
            background-color: #000;
            color: #fff;
            border: none;
            border-radius: 8px;
            padding: 12px 20px;
            margin: 0;
            font-size: 16px;
            width: 100%;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1>–ü–æ—Å–ª–µ–¥–Ω–∏–π —à–∞–≥:</h1>
    <div class="form-container">
        <form id="qrForm">
            <div class="form-group">
                <label for="qrName">–ù–∞–∑–≤–∞–Ω–∏–µ QR-–∫–æ–¥–∞</label>
                <input type="text" id="qrName" name="qrName" required>
            </div>
            <div class="form-group">
                <label for="qrLink">–°—Å—ã–ª–∫–∞</label>
                <input type="text" id="qrLink" name="qrLink" required>
            </div>
            <div class="form-group" id="additionalField" style="display: none;">
                <label for="qrText">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç</label>
                <input type="text" id="qrText" name="qrText">
            </div>
            <button type="button" class="create-button" id="createButton" disabled onclick="createQRCode()">–°–æ–∑–¥–∞—Ç—å QR-–∫–æ–¥</button>
        </form>
    </div>
    <div class="after-buttons" id="afterButtons">
        <button id="backButton" onclick="location.href='index.html'">–í –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é</button>
    </div>

    <script>
        const qrNameInput = document.getElementById('qrName');
        const qrLinkInput = document.getElementById('qrLink');
        const qrTextInput = document.getElementById('qrText');
        const createButton = document.getElementById('createButton');
        const additionalField = document.getElementById('additionalField');
        const afterButtons = document.getElementById('afterButtons');
        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞—á–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ firstClick
        let firstClick = localStorage.getItem('firstClick') === null ? true : JSON.parse(localStorage.getItem('firstClick'));
        const funnyMessages = [
    "–¢–µ—Ä–ø–µ–Ω–∏–µ ‚Äî –ø—É—Ç—å –∫ —É—Å–ø–µ—Ö—É! ü§ì",
    "–í–∞—à QR-–∫–æ–¥ —É–∂–µ –≥–æ—Ç–æ–≤–∏—Ç—Å—è! –ù–µ–º–Ω–æ–≥–æ –º–∞–≥–∏–∏ ‚ú®",
    "–ö—Ç–æ –∂–¥–µ—Ç, —Ç–æ—Ç –ø–æ–ª—É—á–∞–µ—Ç –ª—É—á—à–µ–µ! üï∞Ô∏è",
    "–ß—É–¥–æ —Å–∫–æ—Ä–æ —Å–ª—É—á–∏—Ç—Å—è! ü™Ñ",
    "–ú—ã —Ä–∞–±–æ—Ç–∞–µ–º –Ω–∞–¥ —ç—Ç–∏–º! ü§ñ",
    "QR-–∫–æ–¥ —É–∂–µ –≤ –¥—É—Ö–æ–≤–∫–µ! üçû",
    "–¢–µ—Ä–ø–µ–Ω–∏–µ, –¥—Ä—É–≥ –º–æ–π, —Ç–µ—Ä–ø–µ–Ω–∏–µ... üïäÔ∏è",
    "–ß–µ–º –±–æ–ª—å—à–µ –∂–¥–µ—à—å, —Ç–µ–º —Å–ª–∞—â–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç! üçØ",
    "–ù–µ —Ç–æ—Ä–æ–ø–∏—Å—å, –≤—Å—ë –ø–æ–ª—É—á–∏—Ç—Å—è! üöÄ",
    "QR-–∫–æ–¥—ã —Ç–æ–∂–µ —Ö–æ—Ç—è—Ç –≤–Ω–∏–º–∞–Ω–∏—è! üñ§",
    "–ù–µ–º–Ω–æ–≥–æ –ø–æ–¥–æ–∂–¥–∏—Ç–µ, –∏ –±—É–¥–µ—Ç —Å—é—Ä–ø—Ä–∏–∑! üéâ",
    "–ú—ã –ø–æ—á—Ç–∏ –∑–∞–∫–æ–Ω—á–∏–ª–∏, —á–µ—Å—Ç–Ω–æ-—á–µ—Å—Ç–Ω–æ! üí™",
    "–ö–æ–¥–∏—Ä–æ–≤–∫–∏ –Ω–µ —Ç–µ—Ä–ø—è—Ç —Å—É–µ—Ç—ã! üòå",
    "–ö—Ç–æ —É—Å–ø–µ–ª, —Ç–æ—Ç —É–∂–µ –Ω–∞ —Å—Ç–∞—Ä—Ç–µ! üèÅ",
    "–ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è –±—ã—Å—Ç—Ä–µ–µ, —á–µ–º –≤—ã –¥—É–º–∞–µ—Ç–µ! ‚è≥",
    "–í—ã —Å–ª–∏—à–∫–æ–º –±—ã—Å—Ç—Ä—ã–π –¥–ª—è –Ω–∞—à–µ–π –º–∞–≥–∏–∏! üå†",
    "–í—Å—ë —É–∂–µ –≥–æ—Ç–æ–≤–æ, –ø–æ—á—Ç–∏... üéØ",
    "–ü—Ä–æ—Å—Ç–æ –¥—ã—Ö–Ω–∏ –≥–ª—É–±–∂–µ... üßò",
    "–í—Å–µ —Ö–æ—Ä–æ—à–∏–µ –≤–µ—â–∏ —Ç—Ä–µ–±—É—é—Ç –≤—Ä–µ–º–µ–Ω–∏! üïí",
    "QR-–∫–æ–¥ —Å—Ç–∞–Ω–µ—Ç –∏–¥–µ–∞–ª—å–Ω—ã–º, –∫–∞–∫ –∏—Å–∫—É—Å—Å—Ç–≤–æ üé®",
    "–ú—ã —ç—Ç–æ —É–∂–µ –¥–µ–ª–∞–ª–∏, –Ω–æ –ø–æ–≤—Ç–æ—Ä–∏–º —Ä–∞–¥–∏ –≤–∞—Å! üîÑ",
    "–°–ø–æ–∫–æ–π—Å—Ç–≤–∏–µ, —Ç–æ–ª—å–∫–æ —Å–ø–æ–∫–æ–π—Å—Ç–≤–∏–µ! üòÖ",
    "–ß–µ–º –º–µ–Ω—å—à–µ —Ç–æ—Ä–æ–ø–∏—Ç–µ—Å—å, —Ç–µ–º –±—ã—Å—Ç—Ä–µ–µ –ø–æ–ª—É—á–∏—Ç—Å—è! üõ†Ô∏è",
    "–í –º–∏—Ä–µ –Ω–µ—Ç —Å–ø–µ—à–∫–∏, —Ç–æ–ª—å–∫–æ QR üåå",
    "–°–∫–æ—Ä–æ –±—É–¥–µ—Ç –≥–æ—Ç–æ–≤–æ, –≤–∞—à–µ –≤–µ–ª–∏—á–µ—Å—Ç–≤–æ! üëë",
    "–î–∞–π—Ç–µ –Ω–∞–º –ø–∞—Ä—É —Å–µ–∫—É–Ω–¥ ‚Äî –∏ –º–∞–≥–∏—è —Å–ª—É—á–∏—Ç—Å—è! üßô‚Äç‚ôÇÔ∏è",
    "–ù–∞–∂–∏–º–∞—Ç—å –º–æ–∂–Ω–æ, –Ω–æ –±—ã—Å—Ç—Ä–µ–µ –Ω–µ —Å—Ç–∞–Ω–µ—Ç! ü§≠",
    "–ù–µ –¥—ë—Ä–≥–∞–π—Ç–µ—Å—å, –∫–æ–¥ —Å–∫–æ—Ä–æ –±—É–¥–µ—Ç —Å –≤–∞–º–∏! üö¶",
    "–ú—ã –≤—Å–µ –µ—â–µ –∑–¥–µ—Å—å, –≤—Å—ë –±—É–¥–µ—Ç! üçÄ",
    "–°–∫–æ—Ä–æ –±—É–¥–µ—Ç –≥–æ—Ç–æ–≤–æ, –æ–±–µ—â–∞–µ–º! üôè",
    "QR-–∫–æ–¥ –ø–æ—á—Ç–∏ –∂–∏–≤! ü¶æ",
    "–î–∞–π—Ç–µ –∫–Ω–æ–ø–∫–µ –Ω–µ–º–Ω–æ–≥–æ –æ—Ç–¥–æ—Ö–Ω—É—Ç—å... üò¥",
    "–ú—ã –Ω–∞–¥ —ç—Ç–∏–º —É–∂–µ —Ä–∞–±–æ—Ç–∞–µ–º! ‚ö°",
    "–í—Å—ë –≤ –ø–æ—Ä—è–¥–∫–µ, –º—ã —É—Å–ø–µ–≤–∞–µ–º! üëç",
    "–≠–π, —ç—Ç–æ –∫–Ω–æ–ø–∫–∞, –∞ –Ω–µ —Ç–µ–ª–µ–ø–æ—Ä—Ç! üòÇ",
    "–ú–∏—Ä –Ω–µ —Å–æ–∑–¥–∞–≤–∞–ª—Å—è –∑–∞ –æ–¥–∏–Ω –¥–µ–Ω—å, –≤–∞—à QR —Ç–æ–∂–µ! üåç",
    "–ú—ã –ø–µ—á–µ–º –¥–ª—è –≤–∞—Å –∏–¥–µ–∞–ª—å–Ω—ã–π QR! üç™",
    "–ò—Å–∫—É—Å—Å—Ç–≤–æ —Ç—Ä–µ–±—É–µ—Ç –≤—Ä–µ–º–µ–Ω–∏, —Ç–∞–∫ –∂–µ –∫–∞–∫ –≤–∞—à QR! üñåÔ∏è",
    "QR —Å–∫–æ—Ä–æ —Å—Ç–∞–Ω–µ—Ç –ª–µ–≥–µ–Ω–¥–æ–π, –ø–æ–¥–æ–∂–¥–∏—Ç–µ –Ω–µ–º–Ω–æ–≥–æ! üìú"
];

        const requiresAdditionalField = localStorage.getItem('requiresAdditionalField');

        if (requiresAdditionalField !== null) {
            additionalField.style.display = requiresAdditionalField === 'true' ? 'block' : 'none';
        }

        function updateButtonState() {
            const qrName = qrNameInput.value.trim();
            const qrLink = qrLinkInput.value.trim();
            const qrText = (requiresAdditionalField === 'true') ? qrTextInput.value.trim() : '';
            createButton.disabled = !(qrName && qrLink && (requiresAdditionalField === 'false' || qrText));
        }

        qrNameInput.addEventListener('input', updateButtonState);
        qrLinkInput.addEventListener('input', updateButtonState);
        qrTextInput.addEventListener('input', updateButtonState);

        async function createQRCode() {
           
            const qrName = qrNameInput.value.trim();
            const qrLink = qrLinkInput.value.trim();
            const qrText = (requiresAdditionalField === 'true') ? qrTextInput.value.trim() : null;

            const qrData = {
                backgroundShape: localStorage.getItem('backgroundShape'),
                qrDesign: localStorage.getItem('qrDesign'),
                telegramId: localStorage.getItem('telegramId'),
                name: qrName,
                link: qrLink,
                additionalText: qrText
            };

             // –ó–∞–ø—É—Å–∫–∞–µ–º –∫–æ–Ω—Ñ–µ—Ç—Ç–∏
             const confettiConfig = {
                particleCount: 100,
                startVelocity: 30,
                spread: 360,
                ticks: 60,
                zIndex: 0,
            };
            const duration = 3000;
            const animationEnd = Date.now() + duration;
            const interval = setInterval(() => {
                const timeLeft = animationEnd - Date.now();
                if (timeLeft <= 0) {
                    return clearInterval(interval);
                }
                const particleCount = 50 * (timeLeft / duration);
                confetti(Object.assign({}, confettiConfig, {
                    particleCount,
                    origin: { x: Math.random(), y: Math.random() - 0.2 },
                }));
            }, 250);

            // –ß–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã –≤–Ω–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –æ—Ç–≤–µ—Ç–∞ —Å–µ—Ä–≤–µ—Ä–∞ –ø–æ–∫–∞–∑–∞—Ç—å —á—ë—Ä–Ω—É—é –∫–Ω–æ–ø–∫—É
            setTimeout(() => {
                afterButtons.classList.add('show');
            }, 2000);

            console.log('–û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å:', JSON.stringify(qrData));

            // // –ú–µ–Ω—è–µ–º –∫–Ω–æ–ø–∫—É –Ω–∞ –∑–µ–ª—ë–Ω—É—é –∏ —Ç–µ–∫—Å—Ç
            // createButton.classList.add('success');
            // createButton.textContent = '–û—Ç–ø—Ä–∞–≤–ª—è–µ–º QR-–∫–æ–¥—ã –≤ –≤–∞—à–∏ –ª–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è..';
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —ç—Ç–æ –ø–µ—Ä–≤–æ–µ –Ω–∞–∂–∞—Ç–∏–µ –∏–ª–∏ –Ω–µ—Ç
    if (firstClick) {
        createButton.classList.add('success');
    createButton.textContent = '–û—Ç–ø—Ä–∞–≤–ª—è–µ–º QR-–∫–æ–¥—ã –≤ –≤–∞—à–∏ –ª–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è...';
    firstClick = false; // –ú–µ–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–∞ "–Ω–µ –ø–µ—Ä–≤–æ–µ –Ω–∞–∂–∞—Ç–∏–µ"
    localStorage.setItem('firstClick', JSON.stringify(firstClick)); // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
    } else {
        // –ï—Å–ª–∏ –Ω–µ –ø–µ—Ä–≤–æ–µ –Ω–∞–∂–∞—Ç–∏–µ, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ª—É—á–∞–π–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
        const randomMessage = funnyMessages[Math.floor(Math.random() * funnyMessages.length)];
        createButton.textContent = randomMessage;
        return; // –ó–∞–≤–µ—Ä—à–∞–µ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏
    }

           

            try {
                const response = await fetch('https://qr-dynamic.app:8443/qr-codes/create', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(qrData),
                });

                // –ó–¥–µ—Å—å –Ω–µ –≤–∞–∂–Ω–æ, —á—Ç–æ –æ—Ç–≤–µ—Ç–∏—Ç —Å–µ—Ä–≤–µ—Ä ‚Äì –∫–Ω–æ–ø–∫–∞ —É–∂–µ –ø–æ–∫–∞–∂–µ—Ç—Å—è —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
            }
        }

         // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∫–ª–∏–∫ –ø–æ –∫–Ω–æ–ø–∫–µ "–ù–∞–∑–∞–¥"
document.getElementById('backButton').addEventListener('click', function (e) {
    e.preventDefault(); // –û—Ç–º–µ–Ω—è–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥ –ø–æ —Å—Å—ã–ª–∫–µ
    const telegramId = localStorage.getItem('telegramId');
    const totalScans = localStorage.getItem('totalScans');
    // –ï—Å–ª–∏ –µ—Å—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ localStorage, –¥–æ–±–∞–≤–ª—è–µ–º –∏—Ö –≤ URL
    if (telegramId) {
        window.location.href = `index.html?telegramId=${telegramId}&totalScans=${totalScans}`;
    } else {
        window.location.href = 'index.html'; // –ü–µ—Ä–µ—Ö–æ–¥ –±–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
    }
});
    </script>
</body>
</html>
